<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>스토어</title>
  <link rel="stylesheet" href="/css/layout/common.css"> <!-- 공통 CSS -->
  <!-- Swiper CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css"/>

  <style>
    /* ===== 공통 (라이펫 유사) ===== */
    body {
      margin: 0;
      font-family: 'Roboto', sans-serif;
      background-color: #fff;
      color: #333;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    /* 간격 조금 줄이기 */
    .pm-section {
      padding: 20px 0; /* 기존 40px -> 20px */
      margin-top: 70px; /* 기존 80px -> 70px */
    }
    .main-container {
      display: flex;
      min-height: calc(100vh - 60px);
    }
    .sidebar {
      width: 240px;
      background-color: #fff;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      padding: 1rem;
      border-radius: 4px;
    }
    .content {
      flex: 1;
      padding: 1rem 2rem;
    }

    /* ===== 상품 목록 (4열), 카드 디자인 ===== */
    .product-list {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      /* 간격 조금 줄이기 */
      gap: 0.8rem; /* 기존 1rem -> 0.8rem */
      list-style: none;
      margin: 0;
      padding: 0;
    }
    .product-card {
      background: #fff;
      border-radius: 4px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      text-align: center;
      padding: 1rem;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .product-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.08);
    }
    .product-card h3 {
      margin: 0.8rem 0 0.3rem;
      font-size: 1rem;
      font-weight: 600;
      color: #333;
    }
    .product-card .rating {
      font-size: 0.9rem;
      font-weight: 400;
      color: #666;
      margin-bottom: 0.4rem;
    }
    .product-card .price {
      font-size: 1.05rem;
      font-weight: 700;
      color: #333;
      margin-bottom: 0.4rem;
    }
    .product-card p.category-info {
      font-size: 0.85rem;
      color: #999;
      margin-bottom: 0.5rem;
    }
    .delivery-badge {
      display: inline-flex;
      align-items: center;
      margin-bottom: 0.4rem;
      font-size: 0.85rem;
      color: #666;
    }
    .delivery-badge img {
      width: 18px;
      height: 18px;
      margin-right: 4px;
    }
    .product-card a.details-link {
      display: inline-block;
      margin-top: 0.3rem;
      padding: 0.4rem 0.8rem;
      background-color: #66aee8;
      color: #fff;
      border-radius: 4px;
      text-decoration: none;
      font-size: 0.9rem;
    }
    .product-card a.details-link:hover {
      background-color: #4e9cd8;
    }

    /* ===== 사이드바 카테고리 ===== */
    .sidebar h2 {
      margin-top: 0;
      font-size: 1.2rem;
      margin-bottom: 1rem;
      border-bottom: 1px solid #eee;
      padding-bottom: 0.5rem;
      color: #444;
    }
    .category-list {
      list-style: none;
      margin: 0;
      padding: 0;
    }
    .category-list li {
      margin-bottom: 0.5rem;
      background-color: #fff;
      border-radius: 4px;
      padding: 0.6rem 1rem;
      transition: background-color 0.2s;
      font-weight: 500;
      border: 1px solid #eee;
      cursor: pointer;
    }
    .category-list li:hover {
      background-color: #f0f7ff;
    }
    .category-list li a {
      color: #333;
      text-decoration: none;
      display: block;
    }

    /* ===== 사이드바 버튼들 ===== */
    .sidebar-buttons {
      margin-top: 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      align-items: center;
    }
    .sidebar-buttons button,
    .sidebar-buttons a {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 180px;
      white-space: nowrap;
      background: linear-gradient(to right, #66b6f2, #4e9cd8);
      color: #fff;
      border: none;
      border-radius: 20px;
      padding: 0.6rem 1.2rem;
      font-weight: 600;
      text-decoration: none;
      text-align: center;
      cursor: pointer;
      font-size: 0.9rem;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
    }
    .sidebar-buttons button:hover,
    .sidebar-buttons a:hover {
      background: linear-gradient(to right, #4e9cd8, #66b6f2);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
      transform: translateY(-2px);
    }
    .sidebar-buttons button:active,
    .sidebar-buttons a:active {
      transform: translateY(1px);
      box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
    }

    /* ===== 서브카테고리 탭 ===== */
    .category-header {
      margin-bottom: 1rem;
    }
    .category-title {
      margin: 0;
      font-size: 1.4rem;
      font-weight: bold;
      color: #333;
    }
    .top-controls {
      display: flex;
      align-items: center;
      margin-top: 0.5rem;
      border-bottom: 1px solid #ddd;
      padding-bottom: 0.5rem;
    }
    .subcategory-tabs {
      display: flex;
      gap: 1rem;
    }
    .subcategory-tabs a {
      position: relative;
      padding: 0.6rem 1rem;
      color: #333;
      text-decoration: none;
      font-weight: 500;
      transition: color 0.2s;
      border-bottom: 2px solid transparent;
    }
    .subcategory-tabs a:hover {
      color: #66aee8;
    }
    .subcategory-tabs a.active {
      color: #66aee8;
      font-weight: 600;
      border-bottom: 2px solid #66aee8;
    }

    /* ===== '총 N개' & 정렬 버튼을 한 줄에 배치 ===== */
    .count-sort-row {
      margin: 1rem 0;         /* 위아래 간격 */
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .count-info {
      font-size: 1rem;
      color: #666;
    }
    .sort-container {
      display: inline-flex;
      align-items: center;
      gap: 6px; /* 정렬 라벨과 select 간격 */
    }

    /* ===== 배너 슬라이더 ===== */
    .banner-slider-container {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto 30px auto;
      border-radius: 8px;
      overflow: hidden;
    }
    .swiper-container.banner-swiper {
      position: relative;
      width: 100%;
      height: 300px;
    }
    .banner-swiper .swiper-slide img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    .swiper-button-prev,
    .swiper-button-next {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      z-index: 10;
      width: 50px;
      height: 50px;
      background-color: #fff;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      cursor: pointer;
      color: #000;
      font-size: 18px;
      font-weight: bold;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }
    .swiper-button-prev::after,
    .swiper-button-next::after {
      color: #000 !important;
      font-size: 18px !important;
      font-weight: bold;
    }
    .swiper-button-prev {
      left: 20px;
    }
    .swiper-button-next {
      right: 20px;
    }
    .banner-swiper:hover .swiper-button-prev,
    .banner-swiper:hover .swiper-button-next {
      opacity: 1;
      visibility: visible;
    }

    /* ===== 베스트/NEW 페이지 (중앙제목 & 4열) ===== */
    .main_home {
      margin: 0 auto;
      padding: 30px 15px; /* 간격 약간 줄임 */
      max-width: 1200px;
    }
    .main_home h2 {
      text-align: center;
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 30px;
    }
    .main_home .product_list {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      list-style: none;
      margin: 0;
      padding: 0;
    }
    .main_home .product_list li {
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      text-align: center;
      padding: 16px;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .main_home .product_list li:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .img-wrap {
      position: relative;
      display: inline-block;
    }
    .img-wrap img {
      width: 100%;
      height: 200px;
      object-fit: cover;
      border-radius: 4px;
      display: block;
    }
    .best-rank {
      position: absolute;
      left: 0;
      bottom: 0;
      background-color: #333;
      color: #fff;
      font-weight: bold;
      font-size: 1rem;
      line-height: 1.2;
      padding: 4px 8px;
      border-top-right-radius: 4px;
    }
    .main_home .product_list li h3 {
      margin: 0.5rem 0;
      font-size: 1rem;
      font-weight: bold;
      color: #333;
    }
    .main_home .product_list li .price {
      font-size: 1.05rem;
      font-weight: 700;
      color: #333;
      margin-bottom: 0.4rem;
    }
    .main_home .product_list li .rating {
      font-size: 0.9rem;
      font-weight: 400;
      color: #666;
      margin-bottom: 0.4rem;
    }
    .main_home .product_list li .category-info {
      font-size: 0.85rem;
      color: #999;
      margin-bottom: 0.5rem;
    }
    .main_home .product_list li .delivery-badge {
      display: inline-flex;
      align-items: center;
      margin-bottom: 0.4rem;
      font-size: 0.85rem;
      color: #666;
    }
    .main_home .product_list li .delivery-badge img {
      width: 18px;
      height: 18px;
      margin-right: 4px;
    }
    .main_home .product_list li .details-link {
      display: inline-block;
      margin-top: 0.3rem;
      padding: 0.4rem 0.8rem;
      background-color: #66aee8;
      color: #fff;
      border-radius: 4px;
      text-decoration: none;
      font-size: 0.9rem;
    }
    .main_home .product_list li .details-link:hover {
      background-color: #4e9cd8;
    }

    /* ===== 카테고리 아이콘 바로가기 (스토어홈) ===== */
    .category-shortcut {
      max-width: 1200px;
      margin: 0 auto;
      padding: 30px 0;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .category-shortcut ul {
      list-style: none;
      display: flex;
      gap: 40px;
      margin: 0;
      padding: 0;
    }
    .category-shortcut li {
      text-align: center;
    }
    .category-shortcut li a {
      display: inline-flex;
      flex-direction: column;
      align-items: center;
      text-decoration: none;
      color: #333;
      font-size: 1.2rem;
      font-weight: 700;
      transition: color 0.2s ease;
    }
    .category-shortcut li a:hover {
      color: #66aee8;
    }
    .category-shortcut li img {
      width: 64px;
      height: 64px;
      object-fit: contain;
      margin-bottom: 8px;
    }

    .section-title {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 30px;
      margin-top: 50px;
    }

    /* ===== 뱃지 (NEW, 자체개발) ===== */
    .badge {
      position: absolute;
      top: 8px;
      left: 8px;
      padding: 4px 8px;
      font-size: 0.8rem;
      color: #fff;
      border-radius: 4px;
      font-weight: bold;
    }
    .new-badge {
      background-color: #ff4d4f;
    }
    .custom-badge {
      background-color: #2db7f5;
    }

    /* ===== 사이드 배너 (베스트/NEW 탭에서만) ===== */
	.side-banner-left,
	.side-banner-right {
	  position: fixed;
	  top: 50%; 
	  transform: translateY(-50%); 
	  z-index: 999;
	}
	
	/* 배너가 좀 더 화면 중앙 쪽에 오도록 left/right 값 조정 */
	.side-banner-left {
	  left: 80px;  /* 왼쪽에서 80px */
	}
	.side-banner-right {
	  right: 80px; /* 오른쪽에서 80px */
	}
	
	/* 기장을 키우고 폭은 자동으로 설정 */
	.side-banner-left img,
	.side-banner-right img {
	  width: auto;   
	  height: 450px; /* 기장을 넉넉히 400px 예시 */
	  display: block;
	}
	
	/* 모바일 이하에서 숨기고 싶다면 */
	@media (max-width: 1024px) {
	  .side-banner-left,
	  .side-banner-right {
	    display: none;
	  }
	}
/* 기본 상태: 글자색 #333, 밑줄은 투명(자리만 확보) */
.scrolling-tab .page-tab-area ul li a {
  color: #333;
  font-weight: 500;
  border-bottom: 2px solid transparent;
  transition: color 0.2s, border-bottom-color 0.2s, font-weight 0.2s;
}

/* 마우스 오버 시: 하늘색 살짝 미리 적용해도 좋음(선택사항) */
.scrolling-tab .page-tab-area ul li a:hover {
  color: #68a5fe;
  font-weight: 600;
}

/* 활성 상태(.active) 시: 글자색 & 밑줄색을 같은 하늘색(#68a5fe)으로! */
.scrolling-tab .page-tab-area ul li a.active {
  color: #68a5fe;                /* 글자색 하늘색 */
  font-weight: 700;             /* 더 진하게 */
  border-bottom: 2px solid #68a5fe;  /* 밑줄도 하늘색 */
}
	
  </style>
</head>
<body>
  <!-- 공통 헤더 -->
  <div th:replace="fragment/header :: headerFragment"></div>
  <!-- 스토어 네비게이션 탭 -->
  <div th:replace="fragment/nav :: navFragment2"></div>

  <div class="container">
    <div class="pm-section">
      <!-- sort 값에 따라 화면 전환 -->
      <div th:switch="${sort}">

        <!-- (1) 스토어홈 (storeHome) -->
        <div th:case="'storeHome'">
          <!-- 배너 -->
          <div class="banner-slider-container">
            <div class="swiper-container banner-swiper">
              <div class="swiper-wrapper">
                <div class="swiper-slide"><img src="/images/v1.jpg" alt="배너1"></div>
                <div class="swiper-slide"><img src="/images/v2.jpg" alt="배너2"></div>
                <div class="swiper-slide"><img src="/images/v3.jpg" alt="배너3"></div>
              </div>
              <div class="swiper-button-prev"></div>
              <div class="swiper-button-next"></div>
            </div>
          </div>

          <!-- 카테고리 아이콘 바로가기 -->
          <section class="category-shortcut">
            <ul>
              <li>
                <a th:href="@{'/products/category/1'(petType='CAT', sort='newest')}">
                  <img src="/images/cat1.png" alt="고양이사료 아이콘"/>
                  <span>고양이사료</span>
                </a>
              </li>
              <li>
                <a th:href="@{'/products/category/2'(petType='CAT', sort='newest')}">
                  <img src="/images/cat2.png" alt="고양이간식 아이콘"/>
                  <span>고양이간식</span>
                </a>
              </li>
              <li>
                <a th:href="@{'/products/category/3'(petType='CAT', sort='newest')}">
                  <img src="/images/cat3.png" alt="고양이용품 아이콘"/>
                  <span>고양이용품</span>
                </a>
              </li>
              <li>
                <a th:href="@{'/products/category/4'(petType='DOG', sort='newest')}">
                  <img src="/images/dog1.png" alt="강아지사료 아이콘"/>
                  <span>강아지사료</span>
                </a>
              </li>
              <li>
                <a th:href="@{'/products/category/5'(petType='DOG', sort='newest')}">
                  <img src="/images/dog2.png" alt="강아지간식 아이콘"/>
                  <span>강아지간식</span>
                </a>
              </li>
              <li>
                <a th:href="@{'/products/category/6'(petType='DOG', sort='newest')}">
                  <img src="/images/dog3.png" alt="강아지용품 아이콘"/>
                  <span>강아지용품</span>
                </a>
              </li>
            </ul>
          </section>

          <!-- 가성비 상품 섹션 -->
          <section>
            <h2 class="section-title">가성비 갑! 알뜰하게 득템하세요</h2>
            <div class="product-list">
              <div class="product-card" th:each="p : ${cheapProducts}">
                <div class="img-wrap">
                  <img th:src="@{${!#lists.isEmpty(p.imageUrls) ? p.imageUrls[0] : '/images/default.png'}}" alt="상품 이미지"/>
                  <div class="badge new-badge" th:if="${T(java.lang.Math).random() < 0.4}">NEW</div>
                  <div class="badge custom-badge" th:if="${T(java.lang.Math).random() < 0.6}">자체개발</div>
                </div>
                <h3 th:text="${p.productName}">상품명</h3>
                <p class="price" th:text="${#numbers.formatInteger(p.price, 0)} + '원'"></p>
                <p class="rating">
                  <span th:text="'⭐ ' + ${#numbers.formatDecimal(p.averageRating != null ? p.averageRating : 0.0, 1, 1)}"></span>
                  <span th:text="'(' + (${p.reviewCount} != null ? ${p.reviewCount} : 0) + '개 리뷰)'"></span>
                </p>
                <p class="delivery-badge">
                  <img src="/images/roket.png" alt="배송아이콘">
                  당일발송
                </p>
                <p class="category-info" th:text="'(' + ${p.category.categoryName} + ' / ' + ${p.subcategory.subcategoryName} + ')'"></p>
                <a th:href="@{'/products/' + ${p.productId}}" class="details-link" th:if="${p.productId != null}">자세히 보기</a>
              </div>
            </div>
          </section>

          <!-- 베스트 상품 섹션 -->
          <section>
            <h2 class="section-title">모두가 선택한 베스트! 한 번 써보면 반해요</h2>
            <div class="product-list">
              <div class="product-card" th:each="p : ${bestProducts}">
                <div class="img-wrap">
                  <img th:src="@{${!#lists.isEmpty(p.imageUrls) ? p.imageUrls[0] : '/images/default.png'}}" alt="상품 이미지"/>
                  <div class="badge new-badge" th:if="${T(java.lang.Math).random() < 0.4}">NEW</div>
                  <div class="badge custom-badge" th:if="${T(java.lang.Math).random() < 0.6}">자체개발</div>
                </div>
                <h3 th:text="${p.productName}">상품명</h3>
                <p class="price" th:text="${#numbers.formatInteger(p.price, 0)} + '원'"></p>
                <p class="rating">
                  <span th:text="'⭐ ' + ${#numbers.formatDecimal(p.averageRating != null ? p.averageRating : 0.0, 1, 1)}"></span>
                  <span th:text="'(' + (${p.reviewCount} != null ? ${p.reviewCount} : 0) + '개 리뷰)'"></span>
                </p>
                <p class="delivery-badge">
                  <img src="/images/roket.png" alt="배송아이콘">
                  당일발송
                </p>
                <p class="category-info" th:text="'(' + ${p.category.categoryName} + ' / ' + ${p.subcategory.subcategoryName} + ')'"></p>
                <a th:href="@{'/products/' + ${p.productId}}" class="details-link" th:if="${p.productId != null}">자세히 보기</a>
              </div>
            </div>
          </section>

          <!-- 신상품 섹션 -->
          <section>
            <h2 class="section-title">방금 출시된 따끈따끈 신상! 지금 만나보세요</h2>
            <div class="product-list">
              <div class="product-card" th:each="p : ${newProducts}">
                <div class="img-wrap">
                  <img th:src="@{${!#lists.isEmpty(p.imageUrls) ? p.imageUrls[0] : '/images/default.png'}}" alt="상품 이미지"/>
                  <div class="badge new-badge" th:if="${T(java.lang.Math).random() < 0.4}">NEW</div>
                  <div class="badge custom-badge" th:if="${T(java.lang.Math).random() < 0.6}">자체개발</div>
                </div>
                <h3 th:text="${p.productName}">상품명</h3>
                <p class="price" th:text="${#numbers.formatInteger(p.price, 0)} + '원'"></p>
                <p class="rating">
                  <span th:text="'⭐ ' + ${#numbers.formatDecimal(p.averageRating != null ? p.averageRating : 0.0, 1, 1)}"></span>
                  <span th:text="'(' + (${p.reviewCount} != null ? ${p.reviewCount} : 0) + '개 리뷰)'"></span>
                </p>
                <p class="delivery-badge">
                  <img src="/images/roket.png" alt="배송아이콘">
                  당일발송
                </p>
                <p class="category-info" th:text="'(' + ${p.category.categoryName} + ' / ' + ${p.subcategory.subcategoryName} + ')'"></p>
                <a th:href="@{'/products/' + ${p.productId}}" class="details-link" th:if="${p.productId != null}">자세히 보기</a>
              </div>
            </div>
          </section>
        </div>

        <!-- (2) 전체제품 (all) -->
        <div th:case="'all'">
          <div class="main-container">
            <aside class="sidebar">
              <h2>카테고리</h2>
              <ul class="category-list">
                <li th:each="cat : ${categories}">
                  <a th:href="@{'/products/category/' + ${cat.categoryId} (petType=${selectedPetType}, sort='newest')}"
                     th:text="${cat.categoryName}">카테고리명</a>
                </li>
              </ul>
              <div class="sidebar-buttons">
                <button id="togglePetBtn"></button>
                <a href="/products/add">상품 추가</a>
                <a href="/categories">카테고리 관리</a>
              </div>
            </aside>

            <div class="content">
              <div class="category-header" th:if="${currentCategory != null}">
                <h2 class="category-title" th:text="${currentCategory.categoryName}">카테고리명</h2>

                <div class="top-controls" th:if="${subcategories != null and !subcategories.isEmpty()}">
                  <div class="subcategory-tabs">
                    <a th:href="@{'/products/category/' + ${currentCategory.categoryId} (petType=${selectedPetType}, sort='newest')}"
                       th:classappend="${selectedSubcategoryId == null} ? ' active'">전체</a>
                    <a th:each="sub : ${subcategories}"
                       th:href="@{'/products/subcategory/' + ${sub.subcategoryId} (petType=${selectedPetType}, sort='newest')}"
                       th:classappend="${selectedSubcategoryId == sub.subcategoryId} ? ' active'">
                      <span th:text="${sub.subcategoryName}">소분류</span>
                    </a>
                  </div>
                </div>

                <div class="count-sort-row" th:if="${subcategories != null and !subcategories.isEmpty()}">
                  <div class="count-info">
                    총 <span th:text="${#lists.size(products)}"></span>개
                  </div>
                  <div class="sort-container">
                    <label for="sortFilter">정렬:</label>
                    <select id="sortFilter" onchange="changeSort()">
                      <option value="newest" th:selected="${sort == 'newest'}">신제품순</option>
                      <option value="priceLowHigh" th:selected="${sort == 'priceLowHigh'}">낮은 가격순</option>
                      <option value="priceHighLow" th:selected="${sort == 'priceHighLow'}">높은 가격순</option>
                      <option value="rating" th:selected="${sort == 'rating'}">평점순</option>
                    </select>
                  </div>
                </div>
              </div>

              <div class="product-list">
                <div class="product-card" th:each="product : ${products}">
                  <div class="img-wrap">
                    <img th:src="@{${!#lists.isEmpty(product.imageUrls) ? product.imageUrls[0] : '/images/default.png'}}" alt="Product Image"/>
                    <div class="badge new-badge" th:if="${T(java.lang.Math).random() < 0.4}">NEW</div>
                    <div class="badge custom-badge" th:if="${T(java.lang.Math).random() < 0.6}">자체개발</div>
                  </div>
                  <h3 th:text="${product.productName}">상품명</h3>
                  <p class="price" th:text="${#numbers.formatInteger(product.price, 0)} + '원'"></p>
                  <p class="rating">
                    <span th:text="'⭐ ' + ${#numbers.formatDecimal(product.averageRating != null ? product.averageRating : 0.0, 1, 1)}"></span>
                    <span th:text="'(' + (${product.reviewCount} != null ? ${product.reviewCount} : 0) + '개 리뷰)'"></span>
                  </p>
                  <p class="delivery-badge">
                    <img src="/images/roket.png" alt="배송아이콘">
                    당일발송
                  </p>
                  <p class="category-info" th:text="'(' + ${product.category.categoryName} + ' / ' + ${product.subcategory.subcategoryName} + ')'"></p>
                  <a th:href="@{'/products/' + ${product.productId}}" class="details-link" th:if="${product.productId != null}">자세히 보기</a>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- (3) 베스트 (rating) -->
        <div th:case="'rating'">
          <!-- 왼쪽/오른쪽 고정 배너 -->
          <div class="side-banner-left">
            <a href="#">
              <img src="/images/v4.png" alt="왼쪽배너">
            </a>
          </div>
          <div class="side-banner-right">
            <a href="#">
              <img src="/images/v5.png" alt="오른쪽배너">
            </a>
          </div>

          <section class="main_home best_area">
            <h2>베스트</h2>
            <div class="product-list">
              <div class="product-card" th:each="p, stat : ${products}">
                <div class="img-wrap">
                  <img th:src="@{${!#lists.isEmpty(p.imageUrls) ? p.imageUrls[0] : '/images/default.png'}}" alt="상품 이미지"/>
                  <span class="best-rank" th:text="${stat.count}">1</span>
                  <div class="badge new-badge" th:if="${T(java.lang.Math).random() < 0.4}">NEW</div>
                  <div class="badge custom-badge" th:if="${T(java.lang.Math).random() < 0.6}">자체개발</div>
                </div>
                <h3 th:text="${p.productName}">상품명</h3>
                <p class="price" th:text="${#numbers.formatInteger(p.price, 0)} + '원'"></p>
                <p class="rating">
                  <span th:text="'⭐ ' + ${#numbers.formatDecimal(p.averageRating != null ? p.averageRating : 0.0, 1, 1)}"></span>
                  <span th:text="'(' + (${p.reviewCount} != null ? ${p.reviewCount} : 0) + '개 리뷰)'"></span>
                </p>
                <p class="delivery-badge">
                  <img src="/images/roket.png" alt="배송아이콘">
                  당일발송
                </p>
                <p class="category-info" th:text="'(' + ${p.category.categoryName} + ' / ' + ${p.subcategory.subcategoryName} + ')'"></p>
                <a th:href="@{'/products/' + ${p.productId}}" class="details-link" th:if="${p.productId != null}">자세히 보기</a>
              </div>
            </div>
          </section>
        </div>

        <!-- (4) NEW (newest) -->
        <div th:case="'newest'">
          <!-- 왼쪽/오른쪽 고정 배너 -->
          <div class="side-banner-left">
            <a href="#">
              <img src="/images/v4.png" alt="왼쪽배너">
            </a>
          </div>
          <div class="side-banner-right">
            <a href="#">
              <img src="/images/v5.png" alt="오른쪽배너">
            </a>
          </div>

          <section class="main_home new_area">
            <h2>NEW</h2>
            <div class="product-list">
              <div class="product-card" th:each="p : ${products}">
                <div class="img-wrap">
                  <img th:src="@{${!#lists.isEmpty(p.imageUrls) ? p.imageUrls[0] : '/images/default.png'}}" alt="상품 이미지"/>
                  <div class="badge new-badge" th:if="${T(java.lang.Math).random() < 0.4}">NEW</div>
                  <div class="badge custom-badge" th:if="${T(java.lang.Math).random() < 0.6}">자체개발</div>
                </div>
                <h3 th:text="${p.productName}">상품명</h3>
                <p class="price" th:text="${#numbers.formatInteger(p.price, 0)} + '원'"></p>
                <p class="rating">
                  <span th:text="'⭐ ' + ${#numbers.formatDecimal(p.averageRating != null ? p.averageRating : 0.0, 1, 1)}"></span>
                  <span th:text="'(' + (${p.reviewCount} != null ? ${p.reviewCount} : 0) + '개 리뷰)'"></span>
                </p>
                <p class="delivery-badge">
                  <img src="/images/roket.png" alt="배송아이콘">
                  당일발송
                </p>
                <p class="category-info" th:text="'(' + ${p.category.categoryName} + ' / ' + ${p.subcategory.subcategoryName} + ')'"></p>
                <a th:href="@{'/products/' + ${p.productId}}" class="details-link" th:if="${p.productId != null}">자세히 보기</a>
              </div>
            </div>
          </section>
        </div>

        <!-- fallback -->
        <div th:case="*">
          <p>알 수 없는 탭입니다.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- 푸터 -->
  <div th:replace="fragment/footer :: footerFragment"></div>

  <!-- Swiper JS -->
  <script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>

  <!-- petType 관련 JS -->
  <script th:inline="javascript">
    let currentPetType = /*[[${selectedPetType}]]*/ 'ALL';
    const toggleStates = [
      { label: '고양이 🐱',  type: 'CAT', url: '/products?petType=CAT&sort=all' },
      { label: '강아지 🐶',  type: 'DOG', url: '/products?petType=DOG&sort=all' },
      { label: '전체상품보기', type: 'ALL', url: '/products?sort=all' }
    ];
    let currentIndex = (currentPetType === 'CAT') ? 0 : (currentPetType === 'DOG' ? 1 : 2);

    function setButtonLabel() {
      document.getElementById('togglePetBtn').textContent = toggleStates[currentIndex].label;
    }
    function togglePetType() {
      currentIndex = (currentIndex + 1) % toggleStates.length;
      window.location.href = toggleStates[currentIndex].url;
    }

    function changeSort() {
      const selectedSort = document.getElementById("sortFilter").value;
      const url = new URL(window.location.href);
      url.searchParams.set("sort", selectedSort);
      window.location.href = url.toString();
    }

    document.addEventListener('DOMContentLoaded', function() {
      const togglePetBtn = document.getElementById('togglePetBtn');
      if (togglePetBtn) {
        setButtonLabel();
        togglePetBtn.addEventListener('click', togglePetType);
      }

      // 가격에 3자리 콤마 넣기
      const priceElements = document.querySelectorAll('.price');
      priceElements.forEach(el => {
        const rawText = el.textContent.replace(/[^\d]/g,'');
        const priceNum = parseInt(rawText, 10) || 0;
        el.textContent = priceNum.toLocaleString('en-US') + '원';
      });

      // 메인 배너 Swiper 초기화
      new Swiper('.banner-swiper', {
        loop: true,
        autoplay: { delay: 3000, disableOnInteraction: false },
        navigation: { nextEl: '.swiper-button-next', prevEl: '.swiper-button-prev' }
      });
    });
    
  </script>
</body>
</html>
